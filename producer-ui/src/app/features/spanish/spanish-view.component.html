<div style="padding:16px; font-family:system-ui">
  <div class="titlebar">
    <h2>Timing App — Spanish Service</h2>
    <div class="clock">
      <div class="clock-time">{{ etNow$ | async }} ET</div>
      <div class="clock-date">{{ etDate$ | async }}</div>
    </div>
  </div>

  <!-- Live status / master countdown -->
  <div class="bar" *ngIf="vm$ | async as vm">
    <ng-container *ngIf="vm.s?.masterStartUtc; else notStarted">
      <span class="dot" [class.live]="vm.mc > 0" [class.ended]="vm.mc <= 0"></span>

      <b [class.time-red]="vm.mc <= 0">
        22 min | Master Timer — {{ (vm.mc > 0 ? vm.mc : 0) | mmss }}
      </b>

      <small *ngIf="(hub.lastSyncAgo$ | async) as secs">
        Last sync
        <ng-container *ngIf="secs < 60">&lt;1m</ng-container>
        <ng-container *ngIf="secs >= 60">{{ (secs/60) | number:'1.0-0' }}m</ng-container>
        ago
      </small>
    </ng-container>

    <ng-template #notStarted>
      <b>Master Timer — not started</b>
    </ng-template>
  </div>

  <br>
  <div *ngIf="state as s">
    <h3 style="margin: 12px 0px 0px 0px;">Completed in Main</h3>
    <div class="segments-wrap">
      <table>
        <tr>
          <th>#</th>
          <th>Segment</th>
          <th>Segment Drift</th>
          <th>Total Drift</th>
          <th>Status</th>
          <th>End Time</th>
        </tr>

        <tr *ngFor="let row of completedEnglishWithRunning; let idx = index; trackBy: trackBySegWrap"
          [class.highlight]="row.seg.id === lastCompletedId">
          <td>{{ (row.seg.order ?? (idx + 1)) }}</td>
          <td>{{ row.seg.name }}</td>
          <td>{{ (row.seg.driftSec ?? 0) | signedmmss }}</td>
          <td [style.color]="row.running > 4 ? 'black' : row.running < -4 ? 'red' : 'inherit'">
            {{ row.running | signedmmss:true }}
          </td>
          <td>Complete</td>
          <td>
            <ng-container *ngIf="endedAtFor(row.seg.id, completedEnglishSorted) as endedAt; else noEnded">
              {{ endedAt | date:'h:mm a':'America/New_York' }}
            </ng-container>
            <ng-template #noEnded>—</ng-template>
          </td>
        </tr>
      </table>
    </div>

    <!-- Bottom controls -->
    <div style="margin-top:16px">
      <!-- LINE 1: Spanish ETA input -->
      <div class="bar">
        <label>Enter Time Left (min + sec):
          <input #eta size="5" placeholder="00:00" pattern="^\\d{1,3}:[0-5]\\d$"
            title="Enter minutes and seconds like 1:30" (keyup.enter)="setSpanishEtaFromText(eta.value)">
        </label>

        <button class="btn" type="button" style="margin-left:12px" (click)="setSpanishEtaFromText(eta.value)">
          Send ETA
        </button>

        <span style="margin-left:12px; opacity:.95">
          <span style="color:#0e0d0d; font-weight:700; font-size:13px">
            Current Time Left:
          </span>
          <ng-container *ngIf="currentSpanishRemainingSec() as rem; else noneEta">
            <span style="color:#ff0000; font-weight:700; font-size:13px">
              {{ rem | mmss }}
            </span>
          </ng-container>
          <ng-template #noneEta>—</ng-template>
        </span>
      </div>

      <!-- LINE 3: Sermon Ended At -->
      <div style="margin-top:32px">
        <p style="margin:8px 0 0 0">
          <b>Sermon Ended At:</b>
          <ng-container *ngIf="state?.spanish?.sermonEndedAtSec as ended; else noneEnded">
            {{ spanishEndedAtWallTime() | date:'h:mm a':'America/New_York' }}
          </ng-container>
          <ng-template #noneEnded>—</ng-template>
        </p>
      </div>

      <!-- LINE 4: Sermon End button -->
      <div style="margin-top:6px">
        <button class="btn" (click)="sermonEnd()"
          [disabled]="sermonEndClicked || (state?.spanish?.sermonEndedAtSec ?? 0) > 0">
          Sermon End
        </button>
      </div>
    </div>

    <!-- Mini Rundown -->
    <section *ngIf="showMiniRundown && (doc$ | async) as doc">
      <div class="segments-head">
        <h3>Rundown</h3>
        <span class="total-drift">Total: {{ totalDurationSec(doc) | mmss }}</span>
      </div>

      <div class="segments-wrap">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Start</th>
              <th>Dur</th>
              <th>End</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let seg of doc.segments; let i = index; trackBy: trackById">
              <td>{{ i + 1 }}</td>
              <td>{{ displayTitleDoc(seg) }}</td>
              <td>—</td>
              <td>{{ displayDurDoc(seg) | mmss }}</td>
              <td>—</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>